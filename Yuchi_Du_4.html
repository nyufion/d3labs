<!DOCTYPE html>
<html>
<head>
	<title>Yuchi Du, Homework 4</title>
   <meta charset="utf-8">
	<style type="text/css">
        body {
            margin: 0px;
        }
        
        h1 {
            background-color: black;
            padding: 10px;
        }
        
        h2 {
            padding-left: 10px;
            margin: 0px;
        }
        .countryList {
            list-style: none;
            padding: 10px;
            margin: 0px;
            float: left;
        }
        circle {
            opacity: 0.7;
        }
        .domain {
            fill: none;
            stroke: #000;
        }
        .tick {
            font-size: 12;
        }
        .tick line {
            stroke: #ccc;
        }
	</style>
</head>
<body>
   <h1 style="color: white">Gapiminder - Wealth and Health of Nations</h1>

    <div>
        <h2>Countries</h2>
                <ul class="countryList" id="countryList"> </ul>
        <svg id="viz">
        </svg>
    </div>
   <script src="https://d3js.org/d3.v3.min.js" charset = "utf-8"></script>
   <script>
	var year = 2008;
    var chartWidth = 500;
    var chartHeight = 400;
    var charMargin = {top: 20, left: 30, right: 20, bottom: 20};
    var chartInnerHeight = chartHeight - charMargin.top - charMargin.bottom;
    var chartInnerWidth = chartWidth - charMargin.left - charMargin.right;
    
    
    var list = d3.select("#countryList");
    var chart = d3.select("#viz");
    var xAxisGroup = chart.append("g")
        .attr("transform", "translate(" + charMargin.left + "," + (chartInnerHeight + charMargin.top) + ")");
    var yAxisGroup = chart.append("g")
        .attr("transform", "translate(" + charMargin.left + "," + charMargin.top + ")");
    var dotGroup = chart.append("g")
        .attr("transform", "translate(" + charMargin.left + "," + charMargin.top + ")");
//    var xAxisGroup = chart.append("g")
//        .attr("transform", "translate(" + charMargin.left + "," + (charMargin.top+chartInnerHeight) + ")");
//    var yAxisGroup = chart.append("g")
//        .attr("transform", "translate(" + charMargin.left + "," + charMargin.top + ")");

  
    
    function renderList(data) {
        list.selectAll("li")
                .data(data)
                .enter()
                .append("li")
                .attr("class", "listItem")
                .text(function(d) {return d.name });
//        list.selectAll("li")
//            .data(numbers, function (d) {
//                return d.name
//            });
//        list.enter()
//            .append("li")
//            .attr("class", "listItem")
//            .text(function(d) {return d.name });
//
//        list.exit().remove();
//
//        list.on("click", function (d, i) {
//            numbers.splice(i, 1);
//            renderList(data, numbers);
//        });
    }
    
    function renderChart(data) {
        chart
            .attr("width", chartWidth)
            .attr("height", chartHeight)
            
        var xScale = d3.scale.linear()
            .range([0, chartInnerWidth])
            .domain([-1000, d3.max(data, function(d){ return d.income[year]})]);
            
        var yScale = d3.scale.linear()
            .range([chartInnerHeight, 0])
            .domain([43, d3.max(data, function(d){ return d.lifeExpectancy[year]})]);
            
        var sScale = d3.scale.linear() 
            .range([20, 1000])
            .domain(d3.extent(data, function(d){ return d.population[year]}));            
        var cScale = d3.scale.category10(); 
        
        var xAxis = d3.svg.axis()
            .scale(xScale)
            .orient("bottom")
            .tickSize(-360)
        var yAxis = d3.svg.axis()
            .scale(yScale)
            .orient("left")
            .tickSize(-450)
        
        xAxisGroup.call(xAxis);
        yAxisGroup.call(yAxis);
            
            dotGroup.selectAll("circle")
                .data(data)
                .enter()
                .append("circle")
                    .attr("r", function(d){ return Math.sqrt(sScale(d.population[year])/Math.PI)})
                    .attr("cx", function(d){ return xScale(d.income[year])})
                    .attr("cy", function(d){ return yScale(d.lifeExpectancy[year])})
                    .attr("fill", function(d){ return cScale(d.region)})
    }
    
    function render(data) {
        var filteredData = data.filter(function(d) {
            return d.income[year] && d.lifeExpectancy[year] && d.population[year];
        });
        
        renderList(filteredData);
        renderChart(filteredData, 2008);
    }
    d3.json("https://raw.githubusercontent.com/CristianFelix/infoviz/master/Week%203/newData.json", function (error, result) {
        render(result);
    })
   </script>
</body>
</html>